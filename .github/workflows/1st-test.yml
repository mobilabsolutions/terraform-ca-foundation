name: Test Workflow

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    # env:
    #   LOCATION: ${{ vars.LOCATION }}
    #   ENVIRONMENT: ${{ vars.ENVIRONMENT }}
    #   TIMEZONE: ${{ vars.TIMEZONE }}
    #   LOCATIONABBREVIATION: ${{ vars.LOCATIONABBREVIATION }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
          
      - name: Replace tokens in .tfvars and .tf
        # You may pin to the exact commit or the version.
        # uses: cschleiden/replace-tokens@4d5a042c84c3568b3858b7af9394923d2d5195c9
        uses: qetza/replacetokens-action@v1
        id: replace-tokens
        with:
          root: /germanywestcentral/dev
          sources: |
            **/*.tfvars
          missing-var-action: none
          missing-var-log: warn
          log-level: 'debug'
          variables: >
            {
              "LOCATION": "${{ env.LOCATION }}",
              "ENVIRONMENT": "${{ env.ENVIRONMENT }}"
            }
            
      - run: |
          echo "defaults  : ${{ steps.replace-tokens.outputs.defaults }}"
          echo "files     : ${{ steps.replace-tokens.outputs.files }}"
          echo "replaced  : ${{ steps.replace-tokens.outputs.replaced }}"
          echo "tokens    : ${{ steps.replace-tokens.outputs.tokens }}"
          echo "transforms: ${{ steps.replace-tokens.outputs.transforms }}"

      - run: |
          pwd
          ls -la
          du --max-depth=5 -h
          cat /germanywestcentral/dev/terraform.tfvars
          cat /germanywestcentral/dev/terraform.tf
